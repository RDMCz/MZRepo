# HW 10 â€“ Protokol IPv6

* Specifikace, srovnÃ¡nÃ­ s IPv4, dual-stack, tunel, NAT64.
* Prefix a dÃ©lka prefixu, komprimace nul, nÃ¡zvoslovÃ­ v IPv6
* druhy vysÃ­lÃ¡nÃ­ (unicast, multicast, anycast),
* druhy adres IPv6 vÄetnÄ› pÅ™Ã­kladÅ¯ adres (GUA, LLA, ULA, multicast)
* stanovenÃ­ InterfaceID, ZoneID, pouÅ¾itÃ­ adresy pro ping a web strÃ¡nky
* ND (NDP) â€“ RS, RA, NS, NA, DAD, ICMPv6 â€“ nÃ¡hrada ARP

## IPv6 â€“ Internet Protocol Version 6

* Internet Protocol je zodpovÄ›dnÃ½ za smÄ›rovÃ¡nÃ­ (routovÃ¡nÃ­) paketÅ¯ ze zdroje do cÃ­le
* IP adresa jednoznaÄnÄ› identifikuje sÃ­Å¥ovÃ© rozhranÃ­ na tÅ™etÃ­ vrstvÄ› OSI/ISO
* IPv6 adresy se sklÃ¡dajÃ­ z osmi skupin po ÄtyÅ™ech hexa ÄÃ­slech (0-F) oddÄ›lenÃ½ch dvojteÄkou = __osm hextetÅ¯__
* `0123:BB99:3210:FE00:58A0:4565:98AE:1245`
* Vznikla kvÅ¯li nedostatku IPv4 adres

IPv4 | IPv6
--- | ---
4 oktety | 8 hextetÅ¯
oktet = 8 bitÅ¯ | hextet = 16 bitÅ¯
desÃ­tkovÃ¡ soustava | Å¡estnÃ¡ctkovÃ¡ soustava
0b11111111 = 255 | 0b1111111111111111 = 65535 = 0xFFFF
4 * 8 = 32 bitÅ¯ | 8 * 16 = 128 bitÅ¯
2\*\*32 = 4,29 \* 10\*\*9 | 2\*\*128 = 340 \* 10\*\*36
4 miliardy adres | 340 sextiliÃ³nÅ¯ adres (dlouhÃ¡ Å¡klÃ¡la)
4 billiony adres | 340 undecillionÅ¯ adres (krÃ¡tkÃ¡ Å¡kÃ¡la)

## Koexistence IPv4 a IPv6 â€“ metody pÅ™echodu

### Dual stack (dvojÃ­ zÃ¡sobnÃ­k)

* ZaÅ™Ã­zenÃ­ mÃ¡ hybridnÃ­ zÃ¡sobnÃ­k pro IPv4 a IPv6
* ZaÅ™Ã­zenÃ­ musÃ­ podporovat oba dva protokoly a mÃ­t IPv4 i IPv6 adresu
* Kooperace mezi dvÄ›ma protokoly (pokud je tÅ™eba) se obvykle odehrÃ¡vÃ¡ aÅ¾ v aplikaÄnÃ­ vrstvÄ›

### Tunneling (tunelovÃ¡nÃ­)

* BalenÃ­ jednoho protokolu do druhÃ©ho
* TunelovÃ¡nÃ­ IPv6 datagramÅ¯ pro prÅ¯chod IPv4 sÃ­tÃ­
* Tunel mÃ¡ dva konce, kaÅ¾dÃ½ mÃ¡ IPv4 adresu
* IPv6 datagram je zabalen do IPv4 datagramu, kde adresa odesÃ­latele je zdejÅ¡Ã­ konec tunelu a adresa pÅ™Ã­jemce druhÃ½ konec tunelu
* Datagram je odeslÃ¡n bÄ›Å¾nou IPv4 sÃ­tÃ­, na druhÃ©m konci se rozbalÃ­ a je odeslÃ¡n dÃ¡le po IPv6 sÃ­ti

![Tunelling](./img/HW_10_01.PNG)

### Translation (pÅ™eklad)

* NutnÃ© pro komunikaci IPv4-only zaÅ™Ã­zenÃ­ se zaÅ™Ã­zenÃ­m IPv6-only (dual stack ani tunel nelze pouÅ¾Ã­t)
* ObecnÃ¡ sada pravidel, jak pÅ™eklÃ¡dat kterou poloÅ¾ku v hlaviÄce, normalizovÃ¡no
* IPv6 adresy s vloÅ¾enÃ½m IPv4 (IPv4-embedded)
  * ÄŒÃ¡st prostoru za prefixem u adresy IPv6 je vyhrazena pro reprezentaci IPv4 adresy
  * PÅ™evod IPv4 -> IPv6 snadnÃ½
  * PÅ™evod IPv6 -> IPv4 sloÅ¾itÄ›jÅ¡Ã­, vyuÅ¾Ã­vÃ¡ se dynamickÃ©ho mapovÃ¡nÃ­ (podobnÃ© jako NAT u IPv4 privatnÃ­ch sÃ­tÃ­)
* Ujal se pÅ™echodovÃ½ mechanismus __NAT64__

### Dual-Stack Lite (DS Lite)

* PÅ™Ã­prava na situaci, kdy ISP budou mÃ­t pÃ¡teÅ™nÃ­ sÃ­Å¥ IPv6-only
* TunelovacÃ­ mechanismus, tentokrÃ¡t se ale posÃ­lÃ¡ IPv4 datagram IPv6 sÃ­tÃ­

## Prefix a dÃ©lka prefixu

* ZaÅ™Ã­zenÃ­ umÃ­stÄ›nÃ¡ v jednÃ© (pod)sÃ­ti majÃ­ ve svÃ½ch IP adresÃ¡ch shodnÃ© nejvÃ½znamÄ›jÅ¡Ã­ bity (bity vlevo)
* Velikost ÄÃ¡sti, kterÃ¡ vyjadÅ™uje ÄÃ­slo sÃ­tÄ› je definovÃ¡na pomocÃ­ CIDR notace poÄtem bitÅ¯ zleva = __prefix__
* V IPv4 lze zapsat jako dÃ©lu prefixu `192.168.1.1/24` nebo pomocÃ­ masky `255.255.255.0`
* V IPv6 se zapisuje pouze dÃ©lka prefixu
  * DoporuÄenÃ¡ velikost pro podsÃ­tÄ› je `/64`, aby fungoval Neighbor Discovery Protocol (?)
* S dÃ©lkou prefixu `/64` je tedy 64 bitÅ¯ z leva __Prefix__ (adresa podsÃ­tÄ›) a zbylÃ½ch 64 bitÅ¯ (128-64) je __Interface ID__ (adresa konkrÃ©tnÃ­ho zaÅ™Ã­zenÃ­ v podsÃ­ti)

## Komprimace nul

* ÃšvodnÃ­ nuly ve skupinÄ› se dajÃ­ vynechat (aÅ¾ na jednu)
* Skupiny nulovÃ½ch hextetÅ¯ lze zkrÃ¡tit na `::`, ale pouze jen jednou, zpravidla na delÅ¡Ã­ skupinu nul
* `0123:0000:0000:0000:00ab:0000:0000:0000` lze zapsat jako:
  * `123::ab:0:0:0`
  * `123:0:0:0:ab::`

## Druhy vysÃ­lÃ¡nÃ­ a adres

<table><tbody>
<tr><td><strong>Unicast</strong><td><td>IndividuÃ¡lnÃ­</td><td>Identifikuje prÃ¡vÄ› jedno zaÅ™Ã­zenÃ­.</td></tr>
<tr><td><strong>Multicast</strong><td><td>SkupinovÃ©</td><td>AdresovÃ¡nÃ­ skupin zaÅ™Ã­zenÃ­, data pÅ™ijdou vÅ¡em ÄlenÅ¯m skupiny.</td></tr>
<tr><td><strong>Anycast</strong><td><td>VÃ½bÄ›rovÃ©</td><td>AdresovÃ¡nÃ­ skupiny, data pÅ™ijdou jen nejbliÅ¾Å¡Ã­mu Älenovi skupiny.</td></tr>
</tbody></table>

* Oproti IPv4 broadcast (vÅ¡esmÄ›rovÃ© vysÃ­lÃ¡nÃ­) nenÃ­ potÅ™eba, pouÅ¾Ã­vajÃ­ se obecnÄ›jÅ¡Ã­ typy multicast adres

## Unicast

prefix | vÃ½znam
--: | :--
`::/128` | nedefinovanÃ¡ adresa
`::1/128` | loopback (pingem lze zjistit funkÄnost IP sluÅ¾eb)
`64:FF9B::/96` | IPv4-embedded adress â€“ adresy s vloÅ¾enÃ½m IPv4
`2000::/3` | GUA â€“ global unicast address â€“ individuÃ¡lnÃ­ globÃ¡lnÃ­
`FC00::/7` | ULA â€“ unique local address â€“ unikÃ¡tnÃ­ individuÃ¡lnÃ­ lokÃ¡lnÃ­
`FE80::/10` | LLA â€“ link-local address â€“ individuÃ¡lnÃ­ lokÃ¡lnÃ­ linkovÃ©

### __GUA__ â€“ global unicast address

* PodobnÃ© jako veÅ™ejnÃ© IPv4 adresy, globÃ¡lnÄ› unikÃ¡tnÃ­, smÄ›rovatelnÃ©
* ZatÃ­m byla definovÃ¡na a pÅ™idÄ›luje se jen ÄÃ¡st z nich â€“ prefix 0b001
* ISP dostÃ¡vÃ¡ prefix, jehoÅ¾ ÄÃ¡sti (delÅ¡Ã­ prefix se stejnÃ½m zaÄÃ¡tkem) rozdÄ›luje zÃ¡kaznÃ­kÅ¯m

![GUA](./img/HW_10_02.PNG)

* __Global Routing Prefix__ â€“ GlobÃ¡lnÃ­ smÄ›rovacÃ­ prefix â€“ SÃ­Å¥ovÃ¡ ÄÃ¡st adresy pÅ™idÄ›lenÃ¡ poskytovatelem, obvykle `/48`
* __Interface ID__ â€“ IdentifikÃ¡tor rozhranÃ­ â€“ RozliÅ¡uje zaÅ™Ã­zenÃ­ v rÃ¡mci podsÃ­tÄ› (podobnÃ© jako hostitelskÃ¡ ÄÃ¡st IPv4), doporuÄeno `/64`
* __Subnet ID__ â€“ IdentifikÃ¡tor podsÃ­tÄ› â€“ Prostor mezi nimi; ÄÃ­m vÄ›tÅ¡Ã­, tÃ­m vÄ›tÅ¡Ã­ moÅ¾nÃ© mnoÅ¾stvÃ­ podsÃ­tÃ­
* `2000::/3` â€“ `2000`-`3FFF`, napÅ™.: `2001:db8:3c4d:15::baba:deda`

### __ULA__ â€“ unique local address

* NÃ¡stupce _site local_ adres
* Adresy smÄ›rovatelnÃ© v mnoÅ¾inÄ› spolupracujÃ­cÃ­ch sÃ­tÃ­, napÅ™. spoleÄnost s vÃ­ce poboÄkami

![ULA](./img/HW_10_03.PNG)

* _PÅ™Ã­znak L_ je zatÃ­m vÅ¾dy `1` a proto zatÃ­m vÅ¡echny ULA adresy zaÄÃ­najÃ­ prefixem `FD00::/8` (celkem je vyhrazeno `FC00::/7`)
* 40bitovÃ½ Global ID je nÃ¡hodnÄ› vygenerovanÃ© ÄÃ­slo, zbytek klasika
* napÅ™.: `fd12:3456:789a:1::1`

### __LLA__ â€“ link-local address

* Komunikace na lince (v podsÃ­ti)
* PovinnÃ¡ pro kaÅ¾dÃ© IPv6 zaÅ™Ã­zenÃ­, nesmÄ›rovatelnÃ¡, nastavuje ji OS
* prefix `FE80::/10` __+__ 54 nulovÃ½ch bitÅ¯ __+__ 64bitovÃ½ identifikÃ¡tor rozhranÃ­
* napÅ™.: `fe80::714b:9770:43d4:f8b2`

## Multicast

* PouÅ¾itÃ­ napÅ™. real-time distribuce obrazu a zvuku
* Adresy `FF00::/8`, napÅ™.: `ff35:30:2001:718:1c01:0:0:7`
  * 8 jedniÄek â€“ `FF`
  * 4 bity â€“ pÅ™Ã­znaky
  * 4 bity â€“ dosah, jak daleko ÄlenovÃ© od sebe mohou bÃ½t; napÅ™. `0b0010` (`2`) = linka
  * 112 bitÅ¯ â€“ identifikÃ¡tor skupiny
* Well-known:
  * `FF02::1` â€“ vÅ¡ichni hostÃ© na lince ~"broadcast"
  * `FF02::2` â€“ vÅ¡echny routery na lince (musÃ­ mÃ­t zapnutÃ© `ipv6 unicast-routing`)
  * aj.
* Solicited-Node Multicast Address:
  * PouÅ¾Ã­vÃ¡ ji Neighbor Discovery Protocol, aby zjistil, zdali je urÄitÃ¡ adresa unikÃ¡tnÃ­ na lince
  * SpojenÃ­ prefixu `ff02::1:ff00:0/104` s poslednÃ­mi 24 bity testovanÃ© uni/anycast adresy
  * NapÅ™. `ff02::1:ff00:0/104` + `fe80::2aa:ff:fe`__`28:9c5a`__ = `ff02::1:ff28:9c5a`

## Mrdka stanovenÃ­ InterfaceID, ZoneID, pouÅ¾itÃ­ adresy pro ping a web strÃ¡nky

## mrdka ğŸ¤ ND (NDP) â€“ RS, RA, NS, NA, DAD, ICMPv6 â€“ nÃ¡hrada ARP

## DynamickÃ© adresovÃ¡nÃ­

* Dynamicky se adresuje GUA a ULA (LLA generuje OS)
* Adresa = Prefix + Interface ID (sÃ­Å¥ovÃ¡ ÄÃ¡st + hostitelskÃ¡ ÄÃ¡st)
* Interface ID pÅ™idÄ›luje OS:
  * Podle MAC adresy pomocÃ­ algoritmu EUI-64
    * DoporostÅ™ed MAC adresy vloÅ¾Ã­ `FFFE` a sedmÃ½ bit zleva nastavÃ­ na jedniÄku (pokud nenÃ­)
  * Nebo generovÃ¡no OS, tzv. Privacy Extensions
* ZbÃ½vÃ¡ vyÅ™eÅ¡it pÅ™idÄ›lenÃ­ prefixu:
  * StavovÃ© â€“ DHCPv6 â€“ zaÅ™Ã­zenÃ­ odeÅ¡le na obecnou adresu dotaz ohlednÄ› svÃ½ch parametrÅ¯ a server mu odpovÃ­
  * BezstavovÃ© â€“ SLAAC â€“ smÄ›rovaÄe vedÃ­ vÅ¡e potÅ™ebnÃ© a obÄas tyto informace rozeÅ¡lou vÅ¡em, nebo si o nÄ› zaÅ™Ã­zenÃ­ zaÅ¾Ã¡dÃ¡ (RS â€“ Router solicitation â€“ VÃ½zva smÄ›rovaÄi)

### __RA__ â€“ Router advertisement â€“ OhlÃ¡Å¡enÃ­ smÄ›rovaÄe

* SmÄ›rovaÄe v nÃ¡hodnÃ½ch intervalech zasÃ­lajÃ­ do vÅ¡ech pÅ™ipojenÃ½ch sÃ­tÃ­ informace
* OdeslÃ¡no pomocÃ­ ICMPv6

### __SLAAC__ â€“ StateLess Address AutoConfiguration â€“ BezstavovÃ¡ konfigurace

* PÅ™idÄ›lovÃ¡nÃ­ adres, pouÅ¾itÃ­ RA a RS
* NenÃ­ potÅ™eba DHCPv6 server
* DÅ™Ã­ve RA zprÃ¡vy neobsahovaly IPv6 adresy rekurzivnÃ­ch DNS serverÅ¯

### __Stateless DHCPv6__

* Nadstavba SLAAC
* RA obsahuje pÅ™Ã­znaky, kterÃ© informujÃ­ zaÅ™Ã­zenÃ­, zdali mÃ¡ poÅ¾Ã¡dat DHCPv6 server o dodateÄnÃ© informace (kterÃ© ve SLAAC chybÃ­)

### __Stateful DHCPv6__

* DHCPv6 server pÅ™idÄ›luje i adresu
* SLAAC ale nelze ÃºplnÄ› vypnout, pÅ™idÄ›luje totiÅ¾ vÃ½chozÃ­ brÃ¡nu
